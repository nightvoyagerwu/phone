<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åŠ è½½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>æ‰‹æœºå¯¹æ¯”å·¥å…· - æ•°æ®åŠ è½½æµ‹è¯•</h1>
    <div id="testResults"></div>
    
    <script>
        // è·å–ä»·æ ¼å€¼ï¼ˆå¤„ç†åµŒå¥—ç»“æ„ï¼‰
        function getPriceValue(priceObj) {
            if (!priceObj) return 0;
            
            // å¦‚æœæ˜¯åµŒå¥—ç»“æ„
            if (priceObj.start_price && typeof priceObj.start_price === 'object') {
                return priceObj.start_price.starting_price || 0;
            }
            
            // å¦‚æœæ˜¯ç›´æ¥æ•°å­—
            if (typeof priceObj.start_price === 'number') {
                return priceObj.start_price;
            }
            
            return 0;
        }

        // è·å–å……ç”µä¿¡æ¯ï¼ˆå¤„ç†åµŒå¥—ç»“æ„ï¼‰
        function getChargingInfo(chargingObj) {
            if (!chargingObj) return 'æœªçŸ¥';
            
            // å¦‚æœæ˜¯å¯¹è±¡ç»“æ„
            if (typeof chargingObj === 'object') {
                const wired = chargingObj.wired || '';
                const wireless = chargingObj.wireless || '';
                
                if (wired && wireless) {
                    return `${wired} (æœ‰çº¿) / ${wireless} (æ— çº¿)`;
                } else if (wired) {
                    return `${wired} (æœ‰çº¿)`;
                } else if (wireless) {
                    return `${wireless} (æ— çº¿)`;
                }
            }
            
            // å¦‚æœæ˜¯å­—ç¬¦ä¸²
            if (typeof chargingObj === 'string') {
                return chargingObj;
            }
            
            return 'æœªçŸ¥';
        }

        // è·å–å­˜å‚¨ä¿¡æ¯ï¼ˆå¤„ç†æ•°ç»„ç»“æ„ï¼‰
        function getStorageInfo(storageObj) {
            if (!storageObj) return 'æœªçŸ¥';
            
            // å¦‚æœæ˜¯æ•°ç»„
            if (Array.isArray(storageObj)) {
                return storageObj.join(', ');
            }
            
            // å¦‚æœæ˜¯å­—ç¬¦ä¸²
            if (typeof storageObj === 'string') {
                return storageObj;
            }
            
            return 'æœªçŸ¥';
        }

        // è·å–åç½®æ‘„åƒå¤´ä¿¡æ¯ï¼ˆå¤„ç†åµŒå¥—ç»“æ„ï¼‰
        function getRearCameraInfo(cameraObj) {
            if (!cameraObj) return 'æœªçŸ¥';
            
            // å¦‚æœæ˜¯å¯¹è±¡ç»“æ„
            if (typeof cameraObj === 'object' && !Array.isArray(cameraObj)) {
                const main = cameraObj.main || '';
                const ultra_wide = cameraObj.ultra_wide || '';
                const telephoto = cameraObj.telephoto || '';
                
                const parts = [];
                if (main) parts.push(main);
                if (ultra_wide) parts.push(ultra_wide);
                if (telephoto) parts.push(telephoto);
                
                return parts.length > 0 ? parts.join(', ') : 'æœªçŸ¥';
            }
            
            // å¦‚æœæ˜¯å­—ç¬¦ä¸²
            if (typeof cameraObj === 'string') {
                return cameraObj;
            }
            
            return 'æœªçŸ¥';
        }

        async function testDataLoading() {
            const results = document.getElementById('testResults');
            
            try {
                // æµ‹è¯•1: åŠ è½½JSONæ•°æ®
                addResult('æ­£åœ¨åŠ è½½æ•°æ®æ–‡ä»¶...', 'info');
                const response = await fetch('./data/all_phones_unified.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                addResult('âœ… æ•°æ®æ–‡ä»¶åŠ è½½æˆåŠŸ', 'success');
                
                // æµ‹è¯•2: éªŒè¯æ•°æ®ç»“æ„
                if (!data.phones || !Array.isArray(data.phones)) {
                    throw new Error('æ•°æ®æ ¼å¼é”™è¯¯ï¼šphoneså­—æ®µä¸å­˜åœ¨æˆ–ä¸æ˜¯æ•°ç»„');
                }
                addResult('âœ… æ•°æ®ç»“æ„éªŒè¯é€šè¿‡', 'success');
                
                // æµ‹è¯•3: æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
                const phoneCount = data.phones.length;
                addResult(`ğŸ“± æˆåŠŸåŠ è½½ ${phoneCount} æ¬¾æ‰‹æœºæ•°æ®`, 'success');
                
                // æµ‹è¯•4: æ˜¾ç¤ºå‰3æ¬¾æ‰‹æœº
                addResult('ğŸ” å‰3æ¬¾æ‰‹æœºé¢„è§ˆ:', 'info');
                data.phones.slice(0, 3).forEach((phone, index) => {
                    const priceValue = getPriceValue(phone.price);
                    const storageInfo = getStorageInfo(phone.memory.storage);
                    const chargingInfo = getChargingInfo(phone.battery.charging);
                    const cameraInfo = getRearCameraInfo(phone.camera.rear);
                    
                    addResult(`  ${index + 1}. ${phone.brand} ${phone.model}`, 'info');
                    addResult(`     ä»·æ ¼: ${priceValue > 0 ? 'Â¥' + priceValue.toLocaleString() : 'æœªçŸ¥'}`, 'info');
                    addResult(`     å­˜å‚¨: ${storageInfo}`, 'info');
                    addResult(`     å……ç”µ: ${chargingInfo}`, 'info');
                    addResult(`     æ‘„åƒå¤´: ${cameraInfo}`, 'info');
                });
                
                // æµ‹è¯•5: éªŒè¯å“ç‰Œ
                const brands = [...new Set(data.phones.map(p => p.brand))];
                addResult(`ğŸ¢ åŒ…å«å“ç‰Œ: ${brands.join(', ')}`, 'info');
                
                addResult('ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ‰‹æœºå¯¹æ¯”å·¥å…·åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œã€‚', 'success');
                
            } catch (error) {
                addResult(`âŒ é”™è¯¯: ${error.message}`, 'error');
                addResult('è¯·æ£€æŸ¥ï¼š', 'error');
                addResult('1. data/all_phones_unified.json æ–‡ä»¶æ˜¯å¦å­˜åœ¨', 'error');
                addResult('2. æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®', 'error');
                addResult('3. æ˜¯å¦é€šè¿‡æœ¬åœ°æœåŠ¡å™¨è®¿é—®', 'error');
            }
        }
        
        function addResult(message, type) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            document.getElementById('testResults').appendChild(div);
        }
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨æµ‹è¯•
        window.addEventListener('load', testDataLoading);
    </script>
</body>
</html>